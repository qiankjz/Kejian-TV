<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie_all ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie_all ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie_all ie8" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie_all ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">

  <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/i/378 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title><%= Setting.ktv_subname %>课件交流系统 - <%= @seo[:title] %></title>
  <meta name="author" content="Kejian.TV" />
  <meta name="copyright" content="<%= Time.now.year %> Kejian.TV Ltd." />
  <meta name="keywords" content="<%= @seo[:keywords] %>">
  <meta name="description" content="<%= @seo[:description] %>">

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <meta name="viewport" content="width=device-width">

  <%= javascript_include_tag "pre_application" %>
  <%= stylesheet_link_tag "pre_application", :media => "all" %>
  <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->
  <%= stylesheet_link_tag "ktv/application", :media => "all" %>
  <%= csrf_meta_tag %>
  <!-- More ideas for your <head> here: h5bp.com/d/head-Tips -->
  <!--[if lte IE 8]>
  <script src="/DOM-shim/lib/DOM-shim-ie8.js"></script>
  <![endif]-->
  <!--[if gte IE 9]>
  <script src="/DOM-shim/lib/DOM-shim.js"></script>
  <![endif]-->
  <!--[if !IE]> -->
  <script src="/DOM-shim/lib/DOM-shim.js"></script>
  <!-- <![endif]-->

  <!-- All JavaScript at the bottom, except this Modernizr build.
       Modernizr enables HTML5 elements & feature detects for optimal performance.
       Create your own custom Modernizr build: www.modernizr.com/download/ -->
  <!--[if lt IE 9]>
  <script src="/js/libs/html5.js"></script>
  <![endif]-->
  <!--[if (gte IE 6)&(lte IE 8)]>
   <script src="/js/ie1.js" type="text/javascript"></script>
  <![endif]-->
  <%= stylesheet_link_tag "application" %>
  <!--[if IE]><link rel="stylesheet" type="text/css" href="<%= asset_path('ktv/ie.css') %>" /><![endif]-->
  <!--[if ie 7]><link href="<%= asset_path('ktv/ie7.css') %>" rel="stylesheet" type="text/css" /><![endif]-->
  <!--[if IE 6]>
  <link href="<%= asset_path('ktv/ie6.css') %>" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="/js/iepngfix.min.js"></script>
  <script type="text/javascript">
  iePngFix.fix('.png');
  </script>
  <![endif]-->
  <!--[if IE 8 ]>
    <link href="/css_ie8.css" media="all" rel="stylesheet" type="text/css" />
  <![endif]-->
  <!--[if lt IE 8 ]>
    <link href="<%= asset_path('css_ie.css')%>" media="all" rel="stylesheet" type="text/css" />
  <![endif]-->
  <script src="/js/libs/modernizr-2.5.3.min.js"></script>
  <%= render 'common_header' %>
  <script src="/simple/static/js/common.js" type="text/javascript"></script>
  <script src="/simple/static/js/forum.js" type="text/javascript"></script>
  <%= yield :armpit %>
  <%= flash[:extra_ucenter_operations] %>
</head>

<body <%if @is_ie8 or @is_ie7 or @is_ie6 %>onload="window.psvr_ie_readyfix()"<%end%> id="psvr_subject_all" style="  background: #fdfdfd url(<%= asset_path 'sstatic/skeptics/img/grid_noise_dark.png' %>) repeat left top;<%= 'background-position: 0 112px;' if @we_are_inside_qa and !@we_are_no_zm_header %><%=yield :body_style%>" data-subdomain="<%= request.subdomain %>" class="<%= @we_are_inside_qa ? 'we_are_inside_qa' : '' %>">
<div id="append_parent" class="__dz"></div><div id="ajaxwaitid"></div>
<div class="__sdk">
  <header style="background-image:url(<%= asset_path('dark.png') %>)">
    <div class="wrapper">
      <h1><a href="/" id="core_logotext_wrap"><%= image_tag "logo_ktv_#{Setting.ktv_sub}.png",:alt => "#{Setting.ktv_subname}课件交流系统",:id=>'core_logotext' %></a></h1>
      <form accept-charset="UTF-8" action="/search" id="search_form" method="get" data-width-tobe="<%= Ktv.config.logo_ktv_width ? "#{Ktv.config.logo_ktv_width + 490}" : '730' %>" style="<%= Ktv.config.logo_ktv_width ? "margin-left:#{Ktv.config.logo_ktv_width + 78}px" : '' %>">
        <input type="text" id="q" name="q" value="" class="placeholded" placeholder="全站搜索..." />
      </form>
      <div class="navigation">
        <ul>
<!--
          <li class="raise_ask"><a href="<%= new_ask_path %>" class="lh39 pa0" id="core_addtext_wrap">我要提问</a></li>
-->
<%if request.path.starts_with?('/coursewares_')%>
          <li class="browse"><a href="/" class="lh39 pa0 core_wraps" id="core_all_wrap">返回首页</a></li>
<% else %>    
          <li class="browse"><a href="/coursewares_by_departments" class="lh39 pa0 core_wraps" id="core_all_wrap">课件瀑布</a></li>
<% end %>    

<%if request.path == '/coursewares/new'%>
          <li class="upload"><a href="/" class="lh39 pa0 core_wraps">返回首页</a></li>
<% else %>    
          <li class="upload"><a href="<%= new_courseware_path %>" class="lh39 pa0 core_wraps" id="core_addcw_wrap">上传课件</a></li>
<% end %>
        </ul>
        <div id="amazing-shadow"></div>
        <% if user_signed_in? %>
        <div id="account-notifications">
          <a href="/simple/home.php?mod=space&do=notice">提醒</a>
          <div class="count-badge" style="">8</div>
        </div>
          <ul id="account-settings">
            <li>
              <a class="user" href="<%= user_path(current_user) %>"><%= avatar_tag(current_user,:small47) %><%= current_user.name %>
                <span id="hardest_a_ever"><span dir="ltr" title="your reputation; view reputation changes" class="reputation-score">307</span></span>
                <span title="1 silver badge" class="hardest_span_ever"><span class="badge2"></span><span class="badgecount">1</span></span>
                <span title="10 bronze badges" class="hardest_span_ever"><span class="badge3"></span><span class="badgecount">10</span></span>
                </a>
              <ul>
                <li><a href="<%= invite_users_path %>">邀请好友注册</a></li>
                <li><a href="<%= mine_path %>">我的课件</a></li>
                <li><a href="<%= edit_user_registration_path %>">账号设置</a></li>
                <li><a href="<%= logout_path %>">退出</a></li>
              </ul>
            </li>
          </ul>
        <%else%>
          <ul id="account-settings" style="min-width:100px">
            <li class="psvr"><a class="userloginreg" id="login" href="/login">使用人人网账号登录</a>
            </li>
          </ul>
        <%end%>
      </div>
    </div>
  </header>
</div>

<% if @is_ie %>
  <%= content_for :butt2 do %>
    Asks.completeAll($("#q"));
  <% end %>
<% else %>
  <div style="background:none repeat scroll 0 0 #F5F5F5" id="results_tray_div">
  <div class="wrapper">
  <div class="__qua" id="results_tray" data-data-height="32" style="height:0px">
  <div id="__w2_bOT1DHU_results_frame" class="results_frame new_results_frame">
    <ul id="core_search_ul">
  <li class="instruction" id="__w2_eqidaIV_list_item_0"><a class="result_item" href="#">请输入汉字或拼音作为关键词，这里将立即显示搜索结果</a></li>
    </ul></div>
  </div>
  </div>
  </div>
<% end %>

<div class="__sdk">
<div id="sdk_flashes">
<% if !notice.blank? %>
  <p class="flash notice"><%=raw notice %></p>
  <%= content_for :butt2 do %>
      $("#sdk_flashes .notice").fadeOut().fadeIn();
  <% end %>
<% end %>
<% if !alert.blank? %>
  <p class="flash alert"><%=raw alert %></p>
  <%= content_for :butt2 do %>
      $("#sdk_flashes .alert").fadeOut('fast').fadeIn('fast').fadeOut('fast').fadeIn('fast');
  <% end %>
<% end %>
<% if !flash[:insuf_info].blank? %>
  <p class="flash warning"><%=raw flash[:insuf_info] %></p>
  <%= content_for :butt2 do %>
      $("#sdk_flashes .warning").fadeOut('fast').fadeIn('fast').fadeOut('fast').fadeIn('fast');
  <% end %>
<% end %>
</div></div>

<% if !@we_are_inside_qa or @raw_raw_raw %>
  <%= yield %>
<% else %>
  <%= render 'content_above' %>
  <%= render :partial => 'dz_navi',:locals => {margintop:15} %>

  <div class="__qa">
    <section id="container" class="wrapper clearfix" style="<%='background:white' if @render_no_sidebar %>">
      <section id="main" style="<%= 'width:100%' if @render_no_sidebar %>">
        <section id="mainContent" class="<%= 'askPage' if 'asks_show'==pos_signature %>">
          <% if !@notice.blank? %>
            <% if cookies[:hide_notice] != @notice.id.to_s %>
              <div id="sys_notice">
                <%= raw @notice.body %>
                <div class="info">
                  <span class="date"><%= l @notice.updated_at.getlocal, :format => :long %></span>
                  <a href="#" class="gray_button small" onclick="return App.hideNotice('<%= @notice.id %>');">我知道了</a>
                </div>
              </div>
            <% end %>
          <% end %>
          <% if !notice.blank? %>
            <div class="notice_message"><%= notice %></div>
            <% content_for :butt do %>
              <script type="text/javascript">
                $(".notice_message").fadeOut().fadeIn();
              </script>
            <% end %>
          <% end %>
          <% if !alert.blank? %>
            <div class="alert_message"><%= alert %></div>
            <% content_for :butt do %>
              <script type="text/javascript">
                $(".alert_message").fadeOut().fadeIn();
              </script>
            <% end %>
          <% end %>


          <%= yield %>
        </section>
      </section>
      <% unless @render_no_sidebar %>
        <aside id="sidebar">
          <%= yield :sidebar %>
          <div class="clearfix mt20">
          </div>
        </aside>
      <% end %>
    </section>
  </div>
  
<% end %>

<div class="__qa">
    
  <div id="hidden_new_ask" style="display: none;">
    <form action="/asks" method="post" id="inner_new_ask">
      <%= auth_token %>
      <header>
        创建新题
        <a class="close"  onclick="$.facebox.close(); return false;"></a>
      </header>
      <section>
        <div class="editorBox mt10 clearfix">
          <!-- XXX是这个人人名 -->
          <textarea name="ask[title]" id="new_ask_title_gl" rows="1" class="textarea"></textarea>
          <div class="bar limitwords"></div>
          <textarea name="ask[body]" id="new_ask_body_gl" rows="1" class="textarea mt10"></textarea>
          <div class="bar limitwords"></div>
        </div>
        <ul class="topicNav modify clearfix">
        </ul>
        <div class="addTopic mt5 clearfix" id="theAddTopic" >
          <input type="text" name="topic"><div class="btnNormalSilver"><span class="add_topic">添加</span></div>
        </div>
      </section>
      <input type="hidden" name="topics" value="">
      <footer>
        <div class="btnNormalGreen bold mt20 submit rightbtn"><span>发布题</span></div>
      </footer>
    </form>
  </div>

  <div style="display: none;" id="loading">
    <div class="logo"></div>
    <div class="text">加载中…</div>
  </div>
  
  
  
  <div style="overflow:hidden;" class="hide">
    <%= image_tag("loading.gif") %>
    <div id="report_page">
      <header>举报内容 <a class="close" href="javascript:void(0);"></a></header>
      <section>
        <form id="report_page_form" action="/report.js" onsubmit="App.loading();" method="post" class="simple_form"> 
          <%= auth_token %>
          <input type="hidden" name="url" value="<%= request.path %>" />
          <p class="fc999">请填写举报原因:</p>
          <div class="editorBox mt10 clearfix">
            <textarea name="desc" style="height:80px;"></textarea>
          </div>
        </form>
      </section>
      <footer>
        <div class="btnNormalGreen bold mt20 rightbtn" id="report_submit" >
          <span>提 交</span>
        </div>
      </footer>
    </div>
  </div>
  
</div>


  <div class="__zm">
    <div class="totop" id="backtotop" style="display: none;"><a href="javascript:void(0);">返回 </a></div>
    <div id="loginLayout"></div>
    <div id="newcwLayout"></div>
    <div id="firstload" class="firstload" style="display:none;">加载中...</div>
  </div>
  <!-- JavaScript at the bottom for fast page loading -->

  <%= javascript_include_tag "ktv/application" %>
  <%= javascript_include_tag !@is_ie ? "jquery.ui.autocomplete.js" : "jquery.autocomplete.js" %>
  <script type="text/javascript" charset="utf-8">
    (function($){
    jQuery(function(){
      <%= yield :butt2 %>
      $('#core_addtext_wrap').click(function(){return Asks.addAsk()});
      $('#core_addcw_wrap').click(function(){return KTV.addCW()});
      $('#login').click(function(){return KTV.login()});
      $("abbr.timeago").timeago();
      $("span.relativetime").timeago();
      <% unless current_user %>
        $('.psvr_login_required').attr('onclick','').unbind('click').bind('click',function(){
          return KTV.login();
        });
      <% end %>
    });
    jQuery.fn.extend({
        shareModes:['share-public', 'share-followers','share-private'],
        shareMod:['分享该笔记','只好友可见','仅自己可见'],
        shareModeNum:['1','2','0'],
        resetShareModeClassNames:function() {
          var elements = this;
          elements.removeClass();
          return this;
        },
        resetShareMode:function() {
          this.resetShareModeClassNames();
          return this.each(function() {
            $('#note_shared').attr('value','0');
            jQuery(this).data('shareModeIndex', 0)
              .addClass(jQuery.fn.shareModes[2]).html(jQuery.fn.shareMod[2]);
          });
        },
        toggleShareMode:function() {
          // this.resetShareModeClassNames();
          return this.each(function() {
            var element = jQuery(this);
            var shareModeIndex = element.data('shareModeIndex') || 0;
            shareModeIndex = (shareModeIndex + 1) % jQuery.fn.shareModes.length;
            element.data('shareModeIndex', shareModeIndex)
              .addClass(jQuery.fn.shareModes[shareModeIndex]).html(jQuery.fn.shareMod[shareModeIndex]);
            $('#note_shared').attr('value',jQuery.fn.shareModeNum[shareModeIndex]);  
          });
        }
      });
      })(jQuery);
  </script>
  <script type="text/javascript" charset="utf-8">
     window.wait_till_frame_ready = function(){
       <%= yield :butt3 %>
     }
  </script>
  <%= javascript_include_tag "application" %>
  
  <%= yield :bottom %>
  <%= yield :scripts %>
  
  <script type="text/javascript">
  <% if current_user %>
    var logined = true;
  <% else %>
    var logined = false;
  <% end %>
  </script>
  <%= yield :butt %>
  <!-- end scripts -->

  <%= render 'analytics' unless Rails.env.development? %>

</body>
</html>

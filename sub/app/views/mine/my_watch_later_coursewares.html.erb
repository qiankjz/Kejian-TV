<% content_for :armpit do %>
  <%= stylesheet_link_tag 'ktv/__ytb' %>
  <%= stylesheet_link_tag "ktv/__ytb_manager", :media => "all" %>
<% end %>


<%= render 'mine_above' %>
    <div class="ytg-fl vm-has-videolist vm-list-view" id="yt-admin">
	    <%= render 'manager_nav' %>
    	<div class="ytg-fl " id="yt-admin-content">
    		<div class="clearfix" id="vm-page-subheader">
    			<div class="vm-page-subheader-content">
    				<h3>稍后阅读</h3>
    				<span class="yt-badge-vm" id="vm-num-videos-shown"><%= @coursewares_ids.size %></span>
    			</div>
    		</div>
    		<div id="vm-video-actions-bar" class="goog-scrollfloater">
    			<div class="clearfix" id="vm-video-actions-inner">
    				<span class="yt-uix-form-input-checkbox-container vm-select-all"><input type="checkbox" id="vm-video-select-all" class="yt-uix-form-input-checkbox" name="vm-video-select-all"><span class="yt-uix-form-input-checkbox-element"></span></span>
    				<button role="button" class="addto-button default show-label yt-uix-button yt-uix-button-default" type="button" disabled="True"><span class="yt-uix-button-icon-wrapper">
							<img alt="" src= "<%=asset_path('yt/img/pixel-vfl3z5WfW.gif')%>" class="yt-uix-button-icon yt-uix-button-icon-addto">
								<span class="yt-valign-trick"></span>
							</span>
							<span class="yt-uix-button-content">
								<span class="addto-label">添加到</span>
							</span>
							<img alt="" src= "<%=asset_path('yt/img/pixel-vfl3z5WfW.gif')%>" class="yt-uix-button-arrow">
							<div class="hid" style="display: none;" id="shared-addto-menu">
							  <div class="addto-menu">
							      <div class="addto-loading loading-content">
							        <img src="<%=asset_path('yt/img/pixel-vfl3z5WfW.gif')%>">
							        <span>正在载入播放列表...</span>
							      </div>
							  </div>
							</div>
						</button>
    				<button role="button" class=" yt-uix-button yt-uix-button-default"  id="vm-playlist-play-all" type="button" href="/watch?v=Tc_OmWppLBE&amp;feature=my_watch_later_videos&amp;list=WL9F5E19B09C8D397C">
							<span class="yt-uix-button-content">全部播放 </span>
						</button>
    				<button role="button" class=" yt-uix-button yt-uix-button-default"  id="vm-playlist-remove-videos" type="button" disabled="True">
							<span class="yt-uix-button-content">删除 </span>
						</button>
    				<span id="vm-view-filter">
    				<span id="vm-view-filter-label">观看：</span>
    				<button role="button" class=" yt-uix-button yt-uix-button-text"  id="vm-view-btn" type="button">
							<span class="yt-uix-button-content">最新课件 </span>
							<img alt="" src= "<%=asset_path('yt/img/pixel-vfl3z5WfW.gif')%>" class="yt-uix-button-arrow">
    				<ul style="display: none;" aria-haspopup="true" role="menu" class=" yt-uix-button-menu yt-uix-button-menu-text">
    					<li id="aria-id-15833117830" role="menuitem"><span class=" yt-uix-button-menu-item"  id="oldest" href="?vmo=oldest&amp;sa=1&amp;sf=added">最早上传</span></li>
    					<li id="aria-id-23249337134" role="menuitem"><span class=" yt-uix-button-menu-item"  id="viewed" href="?vmo=viewed&amp;sa=0&amp;sf=viewcount">观看最多</span></li>
    				</ul>
    				</button>
    				</span>
    			</div>
    			<span data-overlay-class="vm-video-actions-delete-overlay" class="yt-uix-overlay">
    			<span class="yt-uix-overlay-content vm-video-actions-delete-overlay-content">
    			<div class="vm-video-actions-delete-full-area">
    				<div class="vm-video-actions-delete-header">
    					<div class="yt-alert yt-alert-naked yt-alert-error ">
    						<div class="yt-alert-icon">
    							<img alt="提醒图标" class="icon master-sprite" src= "<%=asset_path('yt/img/pixel-vfl3z5WfW.gif')%>">
    						</div>
    						<div role="alert" class="yt-alert-content">
    							<span class="yt-alert-vertical-trick"></span>
    							<div class="yt-alert-message">
    								 确认
    							</div>
    						</div>
    					</div>
    				</div>
    				<div class="vm-video-actions-delete-main-area">
    					<span class="vm-video-actions-delete-warning"></span>
    					<div class="vm-video-actions-delete-extra-warning hid">
    					</div>
    					<div class="vm-video-actions-delete-button-area">
    						<button role="button"  class="yt-uix-overlay-close vm-video-actions-delete-button-cancel yt-uix-button yt-uix-button-default" type="button"><span class="yt-uix-button-content">取消 </span></button>
    						<button role="button"  class="vm-video-actions-delete-button-confirm yt-uix-button yt-uix-button-destructive" type="button"><span class="yt-uix-button-content">删除 </span></button>
    					</div>
    				</div>
    			</div>
    			</span>
    			</span>
    		</div>
    		<div id="vm-video-list-container">
    			<ol class="vm-video-list" id="vm-playlist-video-list-ol">

            <% @coursewares_ids.each_with_index do |cw_id,index| %>
              <% item = @coursewares[index] %>
              <%= render :partial => 'cw_item',:locals=>{item:item} %>
            <% end %>

    			</ol>
    		</div>
    		<div id="vm-pagination">
    		</div>
    	</div>
    </div>
<%= render 'mine_below' %>


<script type="text/javascript" charset="utf-8">
	<% content_for :butt2 do %>
  $(window).scroll(function(){
    var hidden = '<div style="visibility: hidden; position: static; top: auto; left: auto; display: block; float: none; margin: 0px; width: 766px; height: 54px;"></div>'
    var cssObj = {
      'left': ($('#vm-page-subheader').offset().left-2).toString()+'px',
      'width': '766px',
      'float': 'none',
      'position': 'fixed',
      'top': '0px'
    };          
    if($(window).scrollTop() >= $('#vm-page-subheader').offset().top +$('#vm-page-subheader').height()){
      if(!$('#vm-video-actions-bar').hasClass('scrollfloat')){
          $('#vm-video-actions-bar').before(hidden);  
          $('#vm-video-actions-bar').addClass('scrollfloat');
          $('#vm-video-actions-bar').css(cssObj);
      }
    }else{
       if($('#vm-video-actions-bar').hasClass('scrollfloat')){
         $('#vm-page-subheader').next().remove();
         $('#vm-video-actions-bar').removeClass('scrollfloat');
         $('#vm-video-actions-bar').removeAttr('style');
       }
    }
  });
	var choose = new Array();
	var sorter = new Array();
	var resort = function(){
		sorter = new Array();
		$('.vm-video-item').each(function(index,li){
			sorter[index] = {};
			sorter[index]['time']=$('input.yt-uix-form-input-checkbox.video-checkbox',li).attr('data-created-at');
			sorter[index]['views_count']=$('input.yt-uix-form-input-checkbox.video-checkbox',li).attr('data-times');
			sorter[index]['li']=li;
		});
	};
	resort();

	$('#vm-view-btn').live('click',function(){
		var ul = $('ul',this);
    ul.remove();

	  cssObj = {
        'top':($(this).offset().top + $(this).width()).toString() + 'px',
        'left':$(this).offset().left.toString() + 'px'
    };
	  ul.css(cssObj);
    
		$('.__ytb').append(ul);
	});
	function sort_by(type){
		if(type=='times'){
			sorter.sort(function(x,y){
				return -(x.views_count - y.views_count)
			});
			$('#vm-playlist-video-list-ol').html('');
			$.each(sorter,function(index,li){
				$('#vm-playlist-video-list-ol').append(li.li);
			});
		}else{
			sorter.sort(function(x,y){
				return -(x.time - y.time)
			});
			$('#vm-playlist-video-list-ol').html('');
			$.each(sorter,function(index,li){
				$('#vm-playlist-video-list-ol').append(li.li);
			});
		}
	}
	$('#vm-video-select-all').live('click',function(){
		choose = new Array();
		if($(this).attr('checked')){
			$('input.yt-uix-form-input-checkbox.video-checkbox').attr('checked',true);
			$('input.yt-uix-form-input-checkbox.video-checkbox').each(function(index,li){
				choose.push($(li).val());
				$(li).parent().addClass('checked');
				$(li).parent().parent().parent().addClass('selected');
			});
			setEnable();
		}else{
			$('input.yt-uix-form-input-checkbox.video-checkbox').attr('checked',false);
			$('input.yt-uix-form-input-checkbox.video-checkbox').each(function(index,li){
				$(li).parent().removeClass('checked');
				$(li).parent().parent().parent().removeClass('selected');
			});
			setDisable();
		}
	});
	
	var setDisable = function(){
      $('.addto-button').attr('disabled',true);
			$('#vm-playlist-remove-videos').attr('disabled',true);
	};
	var setEnable = function(){
    $('button.addto-button').attr('disabled',false);
		$('#vm-playlist-remove-videos').attr('disabled',false);
	}
	$('input.yt-uix-form-input-checkbox.video-checkbox').live('click',function(){
		var len = $('input.yt-uix-form-input-checkbox.video-checkbox').length
		if($(this).attr('checked')){
			if($.inArray($(this).val(),choose)==-1){
				choose.push($(this).val());
			}
			$(this).parent().addClass('checked');
			$(this).parent().parent().parent().addClass('selected');
			setEnable();
			if(choose.length == len){
				$('#vm-video-select-all').attr('checked',true);
			}
		}else{
      var indexOfele = choose.indexOf($(this).val());
			$(this).parent().removeClass('checked');
			$(this).parent().parent().parent().removeClass('selected');
      if(indexOfele != -1){
        choose.splice(indexOfele,indexOfele+1);
      }
      if(choose.length<1){
				setDisable();
      }
			if(choose.length < len){
				$('#vm-video-select-all').attr('checked',false);
			}
		}
		console.log(choose);
	});
	<% end  %>
</script>

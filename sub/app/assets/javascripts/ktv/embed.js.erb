/*!
 * contentloaded.js
 *
 * Author: Diego Perini (diego.perini at gmail.com)
 * Summary: cross-browser wrapper for DOMContentLoaded
 * Updated: 20101020
 * License: MIT
 * Version: 1.2
 *
 * URL:
 * http://javascript.nwbox.com/ContentLoaded/
 * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE
 *
 */
// @win window reference
// @fn function reference
function contentLoaded(e, t) {
    var n = !1,
        r = !0,
        i = e.document,
        s = i.documentElement,
        o = i.addEventListener ? "addEventListener" : "attachEvent",
        u = i.addEventListener ? "removeEventListener" : "detachEvent",
        a = i.addEventListener ? "" : "on",
        f = function (r) {
            if (r.type == "readystatechange" && i.readyState != "complete") return;
            (r.type == "load" ? e : i)[u](a + r.type, f, !1), !n && (n = !0) && t.call(e, r.type || r)
        }, l = function () {
            try {
                s.doScroll("left")
            } catch (e) {
                setTimeout(l, 50);
                return
            }
            f("poll")
        };
    if (i.readyState == "complete") t.call(e, "lazy");
    else {
        if (i.createEventObject && s.doScroll) {
            try {
                r = !e.frameElement
            } catch (c) {}
            r && l()
        }
        i[o](a + "DOMContentLoaded", f, !1), i[o](a + "readystatechange", f, !1), e[o](a + "load", f, !1)
    }
}
var getElementsByClassName = function (e, t, n) {
    return document.getElementsByClassName ? getElementsByClassName = function (e, t, n) {
        n = n || document;
        var r = n.getElementsByClassName(e),
            i = t ? new RegExp("\\b" + t + "\\b", "i") : null,
            s = [],
            o;
        for (var u = 0, a = r.length; u < a; u += 1) o = r[u], (!i || i.test(o.nodeName)) && s.push(o);
        return s
    } : document.evaluate ? getElementsByClassName = function (e, t, n) {
        t = t || "*", n = n || document;
        var r = e.split(" "),
            i = "",
            s = "http://www.w3.org/1999/xhtml",
            o = document.documentElement.namespaceURI === s ? s : null,
            u = [],
            a, f;
        for (var l = 0, c = r.length; l < c; l += 1) i += "[contains(concat(' ', @class, ' '), ' " + r[l] + " ')]";
        try {
            a = document.evaluate(".//" + t + i, n, o, 0, null)
        } catch (h) {
            a = document.evaluate(".//" + t + i, n, null, 0, null)
        }
        while (f = a.iterateNext()) u.push(f);
        return u
    } : getElementsByClassName = function (e, t, n) {
        t = t || "*", n = n || document;
        var r = e.split(" "),
            i = [],
            s = t === "*" && n.all ? n.all : n.getElementsByTagName(t),
            o, u = [],
            a;
        for (var f = 0, l = r.length; f < l; f += 1) i.push(new RegExp("(^|\\s)" + r[f] + "(\\s|$)"));
        for (var c = 0, h = s.length; c < h; c += 1) {
            o = s[c], a = !1;
            for (var p = 0, d = i.length; p < d; p += 1) {
                a = i[p].test(o.className);
                if (!a) break
            }
            a && u.push(o)
        }
        return u
    }, getElementsByClassName(e, t, n)
}, JSON;
JSON || (JSON = {}),
function () {
    "use strict";

    function f(e) {
        return e < 10 ? "0" + e : e
    }
    function quote(e) {
        return escapable.lastIndex = 0, escapable.test(e) ? '"' + e.replace(escapable, function (e) {
            var t = meta[e];
            return typeof t == "string" ? t : "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
        }) + '"' : '"' + e + '"'
    }
    function str(e, t) {
        var n, r, i, s, o = gap,
            u, a = t[e];
        a && typeof a == "object" && typeof a.toJSON == "function" && (a = a.toJSON(e)), typeof rep == "function" && (a = rep.call(t, e, a));
        switch (typeof a) {
            case "string":
                return quote(a);
            case "number":
                return isFinite(a) ? String(a) : "null";
            case "boolean":
            case "null":
                return String(a);
            case "object":
                if (!a) return "null";
                gap += indent, u = [];
                if (Object.prototype.toString.apply(a) === "[object Array]") {
                    s = a.length;
                    for (n = 0; n < s; n += 1) u[n] = str(n, a) || "null";
                    return i = u.length === 0 ? "[]" : gap ? "[\n" + gap + u.join(",\n" + gap) + "\n" + o + "]" : "[" + u.join(",") + "]", gap = o, i
                }
                if (rep && typeof rep == "object") {
                    s = rep.length;
                    for (n = 0; n < s; n += 1) typeof rep[n] == "string" && (r = rep[n], i = str(r, a), i && u.push(quote(r) + (gap ? ": " : ":") + i))
                } else for (r in a) Object.prototype.hasOwnProperty.call(a, r) && (i = str(r, a), i && u.push(quote(r) + (gap ? ": " : ":") + i));
                return i = u.length === 0 ? "{}" : gap ? "{\n" + gap + u.join(",\n" + gap) + "\n" + o + "}" : "{" + u.join(",") + "}", gap = o, i
        }
    }
    typeof Date.prototype.toJSON != "function" && (Date.prototype.toJSON = function (e) {
        return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null
    }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function (e) {
        return this.valueOf()
    });
    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        gap, indent, meta = {
            "\b": "\\b",
            "	": "\\t",
            "\n": "\\n",
            "\f": "\\f",
            "\r": "\\r",
            '"': '\\"',
            "\\": "\\\\"
        }, rep;
    typeof JSON.stringify != "function" && (JSON.stringify = function (e, t, n) {
        var r;
        gap = "", indent = "";
        if (typeof n == "number") for (r = 0; r < n; r += 1) indent += " ";
        else typeof n == "string" && (indent = n);
        rep = t;
        if (!t || typeof t == "function" || typeof t == "object" && typeof t.length == "number") return str("", {
            "": e
        });
        throw new Error("JSON.stringify")
    }), typeof JSON.parse != "function" && (JSON.parse = function (text, reviver) {
        function walk(e, t) {
            var n, r, i = e[t];
            if (i && typeof i == "object") for (n in i) Object.prototype.hasOwnProperty.call(i, n) && (r = walk(i, n), r !== undefined ? i[n] = r : delete i[n]);
            return reviver.call(e, t, i)
        }
        var j;
        text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function (e) {
            return "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
        }));
        if (/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) return j = eval("(" + text + ")"), typeof reviver == "function" ? walk({
            "": j
        }, "") : j;
        throw new SyntaxError("JSON.parse")
    })
}(),
function () {
    var e = [].slice;
    this.Events = {
        on: function (e, t) {
            var n, r, i, s, o;
            r = e.split(" "), n = this.hasOwnProperty("_callbacks") && this._callbacks || (this._callbacks = {});
            for (s = 0, o = r.length; s < o; s++) i = r[s], n[i] || (n[i] = []), n[i].push(t);
            return this
        },
        one: function (e, t) {
            return this.on(e, function () {
                return this.off(e, arguments.callee), t.apply(this, arguments)
            })
        },
        trigger: function () {
            var t, n, r, i, s, o, u;
            t = 1 <= arguments.length ? e.call(arguments, 0) : [], r = t.shift(), i = this.hasOwnProperty("_callbacks") && ((u = this._callbacks) != null ? u[r] : void 0);
            if (!i) return !0;
            for (s = 0, o = i.length; s < o; s++) {
                n = i[s];
                if (n.apply(this, t) === !1) return !1
            }
            return !0
        },
        off: function (e, t) {
            var n, r, i, s, o, u;
            if (!e) return this._callbacks = {}, this;
            i = (u = this._callbacks) != null ? u[e] : void 0;
            if (!i) return this;
            if (!t) return delete this._callbacks[e], this;
            for (r = s = 0, o = i.length; s < o; r = ++s) {
                n = i[r];
                if (n !== t) continue;
                i = i.slice(), i.splice(r, 1), this._callbacks[e] = i;
                break
            }
            return this
        }
    }
}.call(this),
function () {
    var e, t, n = function (e, t) {
        return function () {
            return e.apply(t, arguments)
        }
    }, r = [].slice;
    this.SpeakerDeck || (this.SpeakerDeck = {}), SpeakerDeck.API = function () {
        function o(t) {
            var r, i = this;
            this.iframe = t, this.receive = n(this.receive, this), e(window, "message", this.receive), this.on("change", function (e) {
                return i.currentSlide = e
            }), r = /^(https?)/.exec(this.iframe.src)[0] || "http", this.origin = "" + r + "://ibeike.kejian.tv"
        }
        var i, s;
        for (s in Events) i = Events[s], o.prototype[s] = i;
        return o.prototype.send = function () {
            var e;
            return e = 1 <= arguments.length ? r.call(arguments, 0) : [], this.iframe.contentWindow.postMessage(JSON.stringify(e), this.origin)
        }, o.prototype.nextSlide = function () {
            return this.send("nextSlide")
        }, o.prototype.previousSlide = function () {
            return this.send("previousSlide")
        }, o.prototype.goToSlide = function (e) {
            return this.send("goToSlide", e)
        }, o.prototype.receive = function (e) {
            var t;
            if (e.origin === this.origin) return t = JSON.parse(e.data), this.trigger.apply(this, t)
        }, o.prototype.release = function () {
            return t(window, "message", this.receive)
        }, o
    }(), e = function (e, t, n) {
        return e.addEventListener ? e.addEventListener(t, n, !1) : e.attachEvent ? e.attachEvent("on" + t, n) : e["on" + t] = n
    }, t = function (e, t, n) {
        return e.removeEventListener ? e.removeEventListener(t, n, !1) : e.detachEvent ? e.detachEvent("on" + t, n) : e["on" + t] = null
    }
}.call(this),
function () {
    var t, n, r, i = function (e, t) {
        return function () {
            return e.apply(t, arguments)
        }
    };
    t = function () {
        function t(e, t) {
            var n;
            this.element = e, this.params = t, this.keyup = i(this.keyup, this), this.resize = i(this.resize, this), this.container = this.element.parentNode,this.force_alt = this.element.getAttribute("data-force-alt"), this.force_biji = this.element.getAttribute("data-force-biji"),this.course_slug = this.element.getAttribute("data-course-slug"), this.psvr_display=this.element.getAttribute("data-psvr-display"), this.courseware_slug = this.element.getAttribute("data-courseware-slug"),this.cw_revision = this.element.getAttribute("data-cw-revision"), this.id = this.element.getAttribute("data-id"), this.ratio = this.element.getAttribute("data-ratio") || 4 / 3, (n = this.params) == null && (this.params = {}), this.params.slide = this.element.getAttribute("data-slide")
        }
        return t.init = function () {
            var e, n, r, i, s;
            n = getElementsByClassName("speakerdeck-embed"), s = [];
            for (r = 0, i = n.length; r < i; r++) e = n[r], s.push((new t(e)).setup());
            return s
        }, t.prototype.url = function () {
          if (this.cw_revision) {
            return "http://ibeike.kejian.tv/embed/" + this.courseware_slug + "/revisions/" + this.cw_revision + "?force_biji="+this.force_biji+ "&force_alt="+this.force_alt+"&" + this.toParam();
          }else{
            return "http://ibeike.kejian.tv/embed/" + this.courseware_slug + "?force_biji="+this.force_biji+ "&force_alt="+this.force_alt+'&' + this.toParam();
          }
        }, t.prototype.toParam = function () {
            var e, t;
            return function () {
                var n, r;
                n = this.params, r = [];
                for (e in n) t = n[e], t && r.push("" + e + "=" + encodeURIComponent(t));
                return r
            }.call(this).join("&")
        }, t.prototype.setup = function () {
            return this.createFrame(), this.api = new SpeakerDeck.API(this.iframe), this.resize(), this.bindEvents(), this.insert()
        }, t.prototype.createFrame = function () {
            return this.iframe = document.createElement("iframe"), this.iframe.className = "speakerdeck-iframe", this.iframe.id='cwiframe_'+this.courseware_slug,window['cwiframe_'+this.courseware_slug]=this, this.iframe.style["-webkit-border-radius"] = "5px", this.iframe.style["-moz-border-radius"] = "5px", this.iframe.style["border-radius"] = "5px", this.iframe.style.border = "0", this.iframe.style.background = "transparent", this.iframe.style.margin = "0", this.iframe.style.padding = "0", this.iframe.border = 0, this.iframe.frameBorder = 0, this.iframe.allowTransparency = !0, this.iframe.src = this.url(), this.iframe.setAttribute("allowfullscreen", !0), this.iframe.setAttribute("mozallowfullscreen", !0), this.iframe.setAttribute("webkitallowfullscreen", !0)
        }, t.prototype.insert = function () {
            return this.container.replaceChild(this.iframe, this.element), typeof window.onSpeakerDeckPlayerReady == "function" ? window.onSpeakerDeckPlayerReady(this.api) : void 0
        }, t.prototype.resize = function () {
            return this.iframe.style.width = this.width() + "px", this.iframe.style.height = this.height() + "px"
        }, t.prototype.width = function () {
            return this.container.offsetWidth - 2
        }, t.prototype.height = function () {
            return (this.width() - 2) / this.ratio + 64
        }, t.prototype.bindEvents = function () {
            var e = this;
            return n(document, "keyup", this.keyup), n(window, "resize", r(this.resize, 100)), n(this.iframe, "load", function () {
                return e.api.send("setup")
            })
        }, t.prototype.next = function () {
            return this.api.nextSlide(), !1
        }, t.prototype.prev = function () {
            return this.api.previousSlide(), !1
        }, t.prototype.keyup = function () {
            var t, n;
            n = document.activeElement.tagName.toLowerCase();
            if (n !== "input" && n !== "textarea") {
                t = window.event ? window.event.keyCode : e.keyCode;
                switch (t) {
                    case 39:
                        return this.next();
                    case 37:
                        return this.prev()
                }
            }
        }, t
    }.call(this), n = function (e, t, n) {
        return e.addEventListener ? e.addEventListener(t, n, !1) : e.attachEvent ? e.attachEvent("on" + t, n) : e["on" + t] = n
    }, r = function (e, t) {
        var n;
        return n = null,
        function () {
            var r, i;
            return i = this, r = arguments, clearTimeout(n), n = setTimeout(function () {
                return e.apply(i, r)
            }, t)
        }
    }, this.SpeakerDeck && (this.SpeakerDeck.Embed = t), contentLoaded(window, t.init), n(window, "popstate", t.init), n(document, "speakerdeck", t.init)
}.call(this);
